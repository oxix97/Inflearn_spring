package study.spring_proxy.config.v2_dynamicproxy;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.annotation.Order;
import study.spring_proxy.aop.v1.OrderRepositoryImpl_V1;
import study.spring_proxy.aop.v1.OrderRepository_V1;
import study.spring_proxy.trace.logtrace.LogTrace;

import java.lang.reflect.Proxy;

@Configuration
public class DynamicProxyBasicConfig {

    @Bean
    public OrderRepository_V1 orderRepository(LogTrace trace) {
        OrderRepositoryImpl_V1 repository = new OrderRepositoryImpl_V1();
        return (OrderRepository_V1) Proxy.newProxyInstance(
                OrderRepository_V1.class.getClassLoader(),
                new Class[]{OrderRepository_V1.class},
                new LogTraceBasicHandler(repository, trace)
        );
    }
}
